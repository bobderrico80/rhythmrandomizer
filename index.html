<html>
	<head>
	<link rel="stylesheet" type="text/css" href="stylesheet.css">
	<title>Rhythm Randomizer</title>
	<script>	
		
		//constructor for note object
		function Note(text,length) {
			this.text = text;
			this.length = length;
		}
				
		
		//Cookie functions
		//Sets a cookie
		function setCookie(cname,cvalue,exdays) {
			var date = new Date();
			date.setTime(date.getTime() + (exdays*24*60*60*1000));
			var expires = "expires=" + date.toGMTString();
			document.cookie = cname + "=" + cvalue + "; " + expires;
		}
		
		//Gets a cookie
		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for (var i=0; i < ca.length; i++) {
				var c = ca[i].trim();
				if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
			}
			return "";
		}
		
		//Checks for the cookie
		function checkCookie() {
			var user=getCookie("username");
			if (user != "") {
				alert("Welcome back, " + user);
			} else {
				user = prompt("Please enter your name:","");
				if (user != "" && user != null) {
					setCookie("username",user,30);
				}
			}
		}
		
		//randomizer function
		function randomize(){	
			
			var opts=26; //number of currently available note options below - update when new notes are added
			
			//checks to see that at least one note option is checked
			var noneChecked = true;
			
			for (var i=0; i < document.getElementById("noteoptions").length; i++) {
				if (document.getElementById("noteoptions").elements[i].checked) {
					noneChecked = false;
					break;
				}
			}
			
			if (noneChecked) {
				alert ("Please select at least one note option")
				return;
			}
			
			//Gets time signature setting from page and sets variables
			var tsindex = document.getElementById("tsselect").selectedIndex;
			switch(tsindex) {
				case 0:
					ts=4;
					var rstring="$&nbsp";
					break;
				case 1:
					ts=3;
					var rstring="#&nbsp";
					break;
				case 2:
					ts=2;
					var rstring="@&nbsp";
					break;
			}
			
			//Gets phrase length setting from page
			var pl = document.getElementById("phraselength").value;
			
			//Changes size of music font based on selected phrase length
			switch (pl) {
				case "1":
					document.getElementById("rhythm").style.fontSize='10em';
					break;
				case "2":
					document.getElementById("rhythm").style.fontSize='6em';
					break;
				case "4":
					document.getElementById("rhythm").style.fontSize='4em';
					break;
				case "8":
					document.getElementById("rhythm").style.fontSize='4em';
					break;
			}
			
			//section defining Note objects
			//basic notes
			var qn = new Note("q&nbsp",1); //quarter note //case 0
			var hn = new Note("h&nbsp&nbsp",2); //half note //case 1
			var wn = new Note("w&nbsp&nbsp&nbsp&nbsp",4); //whole note //case 2
			//basic rests
			var qr = new Note("Q&nbsp",1); //quarter rest //case 3
			var hr = new Note("H&nbsp&nbsp",2); //half rest //case 4
			var wr = new Note("&nbsp&nbspW&nbsp&nbsp",ts) //whole rest //case 5
			//basic subdivisions
			var een = new Note("n&nbsp",1); //two beamed 8th notes //case 6
			var ssssn = new Note("y&nbsp",1); //four beamed 16th notes //case 7
			var essn = new Note("m&nbsp",1); //one 8th note and two 16th notes, beamed //case 8
			var ssen = new Note("M&nbsp",1); //two 16th notes and one 8th note, beamed //case 9
			var sesn = new Note("&#353&nbsp",1); //one 16th note, one 8th note, and one 16th note, beamed //case 21
			//dotted rhythms
			var dhn = new Note("d&nbsp&nbsp&nbsp",3); //dotted half note //case 10
			var dqen = new Note("j&nbspe",2); //dotted quarter note, followed by an 8th note //case 11
			var edgn = new Note("ej&nbsp",2); //8th note, followed by a dotted quarter note //case 12
			var desn = new Note("o&nbsp",1); //dotted 8th & 16th note, beamed //case 13
			var sden = new Note("O&nbsp",1); //16th & dotted 8th note, beamed //case 14
			//basic tuplets
			var qnt = new Note("t&nbsp&nbsp",2); //quarter note triplet //case 15
			var ent = new Note("T&nbsp",1); //8th note triplet //case 16
			//8th rest rhythms
			var ener = new Note("eE&nbsp",1); //8th note followed by an 8th rest //case 17
			var eren = new Note("Ee&nbsp",1); //8th rest followed by an 8th note //case 18
			var ssner = new Note("NE&nbsp",1); //two beamed 16th notes followed by an 8th rest //case 19
			var erssn = new Note("EN&nbsp",1); //8th rest followed by two beamed 16th notes //case 20
			//16th rest rhythms
			var srsssn = new Note("SsN",1); //one 16th rest, one 16th note, two 16th notes, beamed //case 22
			var srssnsr = new Note("SNS",1); //one 16th rest, two 16th notes, beamed, one 16th rest //case 23
			var ersrsn = new Note("E&nbspSs",1); //one 8th rest, one 16th rest, one 16th note //case 24
			var srsner = new Note("SsE&nbsp",1); //one 16th rest, one 16th note, one 8th rest //case 25
			var srsnsrsn = new Note("SsSs",1); //one 16th rest, one 16th note, one 16th rest, one 16th note //case 26
			//Quarter-8th syncopations
			var enqnen = new Note("eq&nbspe&nbsp",2); //one 8th note, one quarter note, one 8th note //case 27
			var enqnqnen = new Note("eq&nbspq&nbspe&nbsp",3); //one 8th note, two quarter notes, one 8th note //case 28
			var enqnqnqnen = new Note("eq&nbspq&nbspq&nbspe&nbsp",4); //one 8th note, three quarter notes, one 8th note //case 29
			var erqnen = new Note("Eq&nbspe&nbsp",2); //one 8th rest, one quarter note, one 8th note //case 30
			var erqnqn
			
			
			//code for selecting notes by random
			var i=0; //iterator for measures
			var j=0; //iterator for the phrase
			
			//loop for generating each measure in the phrase
			while (j < pl) {
						
				//loop for generating notes in the measure
				while (i < ts) {
					var random = Math.round(Math.random() * opts);
					switch (random) {
						case 0:	//qn					
							if (document.getElementById("0").checked == false) break;
							if (i + qn.length > ts) break;
							rstring = rstring + qn.text;
							i = i + qn.length;
							break;
						case 1:	//hn					
							if (document.getElementById("1").checked == false) break;
							if (i + hn.length > ts) break;
							rstring = rstring + hn.text;
							i = i + hn.length;
							break;
						case 2:	//wn					
							if (document.getElementById("2").checked == false) break;
							if (i + wn.length > ts) break;
							rstring = rstring + wn.text;
							i = i + wn.length;
							break;
						case 3:	//qr					
							if (document.getElementById("3").checked == false) break;
							if (i + qr.length > ts) break;
							rstring = rstring + qr.text;
							i = i + qr.length;
							break;
						case 4:	//hr					
							if (document.getElementById("4").checked == false) break;
							if (i + hr.length > ts) break;
							rstring = rstring + hr.text;
							i = i + hr.length;
							break;
						case 5:	//wr					
							if (document.getElementById("5").checked == false) break;
							if (i + wr.length > ts) break;
							rstring = rstring + wr.text;
							i = i + wr.length;
							break;
						case 6:	//een					
							if (document.getElementById("6").checked == false) break;
							if (i + een.length > ts) break;
							rstring = rstring + een.text;
							i = i + een.length;
							break;
						case 7:	//ssssn					
							if (document.getElementById("7").checked == false) break;
							if (i + ssssn.length > ts) break;
							rstring = rstring + ssssn.text;
							i = i + ssssn.length;
							break;
						case 8:	//essn					
							if (document.getElementById("8").checked == false) break;
							if (i + essn.length > ts) break;
							rstring = rstring + essn.text;
							i = i + essn.length;
							break;
						case 9:	//ssen					
							if (document.getElementById("9").checked == false) break;
							if (i + ssen.length > ts) break;
							rstring = rstring + ssen.text;
							i = i + ssen.length;
							break;
						case 10: //dhn					
							if (document.getElementById("10").checked == false) break;
							if (i + dhn.length > ts) break;
							rstring = rstring + dhn.text;
							i = i + dhn.length;
							break;
						case 11: //dqen					
							if (document.getElementById("11").checked == false) break;
							if (i + dqen.length > ts) break;
							rstring = rstring + dqen.text;
							i = i + dqen.length;
							break;
						case 12: //edgn					
							if (document.getElementById("12").checked == false) break;
							if (i + edgn.length > ts) break;
							rstring = rstring + edgn.text;
							i = i + edgn.length;
							break;
						case 13: //desn					
							if (document.getElementById("13").checked == false) break;
							if (i + desn.length > ts) break;
							rstring = rstring + desn.text;
							i = i + desn.length;
							break;
						case 14: //sden					
							if (document.getElementById("14").checked == false) break;
							if (i + sden.length > ts) break;
							rstring = rstring + sden.text;
							i = i + sden.length;
							break;
						case 15: //qnt					
							if (document.getElementById("15").checked == false) break;
							if (i + qnt.length > ts) break;
							rstring = rstring + qnt.text;
							i = i + qnt.length;
							break;
						case 16: //ent					
							if (document.getElementById("16").checked == false) break;
							if (i + ent.length > ts) break;
							rstring = rstring + ent.text;
							i = i + ent.length;
							break;
						case 17: //ener					
							if (document.getElementById("17").checked == false) break;
							if (i + ener.length > ts) break;
							rstring = rstring + ener.text;
							i = i + ener.length;
							break;
						case 18: //eren					
							if (document.getElementById("18").checked == false) break;
							if (i + eren.length > ts) break;
							rstring = rstring + eren.text;
							i = i + eren.length;
							break;
						case 19: //ssner					
							if (document.getElementById("19").checked == false) break;
							if (i + ssner.length > ts) break;
							rstring = rstring + ssner.text;
							i = i + ssner.length;
							break;
						case 20: //erssn					
							if (document.getElementById("20").checked == false) break;
							if (i + erssn.length > ts) break;
							rstring = rstring + erssn.text;
							i = i + erssn.length;
							break;
						case 21: //sesn
							if (document.getElementById("21").checked == false) break;
							if (i + sesn.length > ts) break;
							rstring = rstring + sesn.text;
							i = i + sesn.length;
							break;
						case 22: //srsssn
							if (document.getElementById("22").checked == false) break;
							if (i + srsssn.length > ts) break;
							rstring = rstring + srsssn.text;
							i = i + srsssn.length;
							break;
						case 23: //srssnsr
							if (document.getElementById("23").checked == false) break;
							if (i + srssnsr.length > ts) break;
							rstring = rstring + srssnsr.text;
							i = i + srssnsr.length;
							break;
						case 24: //ersrsn
							if (document.getElementById("24").checked == false) break;
							if (i + ersrsn.length > ts) break;
							rstring = rstring + ersrsn.text;
							i = i + ersrsn.length;
							break;
						case 25: //srsner
							if (document.getElementById("25").checked == false) break;
							if (i + srsner.length > ts) break;
							rstring = rstring + srsner.text;
							i = i + srsner.length;
							break;
						case 26: //srsnsrsn
							if (document.getElementById("26").checked == false) break;
							if (i + srsnsrsn.length > ts) break;
							rstring = rstring + srsnsrsn.text;
							i = i + srsnsrsn.length;
							break;
					}
				}
				
				if (j == pl - 1) break; //breaks out of loop when phrase length is reached
				
				
				rstring = rstring + "&nbsp| ";
				if (j == 3) {
					rstring = rstring + "<br>"; //inserts a line break if more than 4 measures
				}
				j++;
				i=0; //resets beat count for next measure
			}
			//adds final barline
			rstring = rstring + "]" 
			
			//writes string to HTML page
			document.getElementById("rhythmnotation").innerHTML=rstring;
		}	
		</script>
	</head>
	<body> <!-- removed onload="checkCookie()"-->
		
		<div id="randomize">
			<button type="button" name="randomize" onclick="randomize()">Randomize!</button>
		</div>
		<div id="rhythm"><span id="rhythmnotation"></span></div>
		<div id="optscontainer">
			<table id="optstable" cellspacing="0">
				<tr>
					<th>General Options</th>
					<th colspan=2>Note Options</th>
				</tr>
				<tr id="optsrow">
					<td id="genopts">
						<h3>Time Signature:</h3>
						<select id="tsselect">
							<option value="4">4/4 Time</option>
							<option value="3">3/4 Time</option>
							<option value="2">2/4 Time</option>
						</select>
						<h3>Phrase Length:</h3>
						<select id="phraselength">
							<option value="1">1 measure</option>
							<option value="2" selected>2 measures</option>
							<option value="4">4 measures</option>
							<option value="8">8 measures</option>
						</select>
					</td>
					<form id="noteoptions">
						<td id="noteoptsleft">
							<h3>Basic Notes:</h3>
							<div class="notation">
								<input type="checkbox" id="0" checked>q</input>
								<input type="checkbox" id="1" checked>h</input>
								<input type="checkbox" id="2" checked>w</input>
							</div>
							<h3>Basic Rests:</h3>
							<div class="notation">
								<input type="checkbox" id="3" checked>Q</input>
								<input type="checkbox" id="4">H</input>
								<input type="checkbox" id="5">W</input>
							</div>
							<h3>Basic Tuplets:</h3>
							<div class="notation">
								<input type="checkbox" id="15">t</input>
								<input type="checkbox" id="16">T</input>
							</div>
							<h3>Quarter/8th Syncopations</h3>
							<div class="notation">
								<input type="checkbox" id="27">SsE</input>
							</div>
						</td>
						<td id="noteoptsright">
							<h3>Basic Subdivisions:</h3>
							<div class="notation">
								<input type="checkbox" id="6" checked>n</input>
								<input type="checkbox" id="7">y</input>
								<input type="checkbox" id="8">m</input>
								<input type="checkbox" id="9">M</input>
								<input type="checkbox" id="21">&#353</input>
							</div>
							<h3>Dotted Rhythms:</h3>
							<div class="notation">
								<input type="checkbox" id="10">d</input>
								<input type="checkbox" id="11">j e</input>
								<input type="checkbox" id="12">ej</input>
								<input type="checkbox" id="13">o</input>
								<input type="checkbox" id="14">O</input>
							</div>
							<h3>8th Rest Rhythms:</h3>
							<div class="notation">
								<input type="checkbox" id="17">eE</input>
								<input type="checkbox" id="18">Ee</input>
								<input type="checkbox" id="19">NE</input>
								<input type="checkbox" id="20">EN</input>
							</div>
							<h3>16th Rest Rhythms</h3>
							<div class="notation">
								<input type="checkbox" id="22">SsN</input>
								<input type="checkbox" id="23">SNS</input>
								<input type="checkbox" id="24">E&nbspSs</input>
								<input type="checkbox" id="25">SsE</input>
								<input type="checkbox" id="26">SsSs</input>
							</div>
						</td>
					</form>
				</tr>
			</table>
		</div>
		<div id="copyright">
			<p>Copyright &copy 2014 by <a href="mailto:bobderrico80@gmail.com">Robert D'Errico</a></p>
			<p>Notation symbols generated using the <a href="http://www.fontspace.com/robert-allgeyer/musisync" target="_blank">MusiSync</a> font by Robert Allgeyer, used under the SIL Open Font License (OFL)</p>
			<p><a href="changelog.html" target="_blank">Version 1.02</a></p>
		</div>
		<script>
			//sets and initial random rhythm
			randomize();
			
		</script>
	</body>
</html>